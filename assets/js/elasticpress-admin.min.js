!function(a){var b={pauseIndexing:!1,epSitesRemaining:0,epTotalToIndex:0,epTotalIndexed:0,epSitesCompleted:0,run_index_button:a("#ep_run_index"),pause_index_button:a("#ep_pause_index"),restart_index_button:a("#ep_restart_index"),keep_active_checkbox:a("#ep_keep_active"),site_selector:a("#ep_site_select"),status:a("#progressstats"),bar:a("#progressbar"),index_progress_box:a("#indexprogresss"),performIndex:function(b){this.pauseIndexing||(a(this.pause_index_button).val(ep.running_index_text).removeClass("button-primary").attr("disabled",!0),a(this.keep_active_checkbox).attr("disabled",!0),a(this.restart_index_button).removeClass("hidden"),a(this.pause_index_button).addClass("hidden"),this.showProgressBar(),this.processIndex())},processIndex:function(c,d,e,f,g){var h=this,i={action:"ep_launch_index",nonce:ep.nonce};a.ajax({url:ajaxurl,type:"POST",data:i,complete:function(c){if("undefined"==typeof c.responseJSON||"undefined"==typeof c.responseJSON.data)h.status.text(ep.failed_text),a(h.run_index_button).val(ep.index_complete_text).attr("disabled",!1),a(h.pause_index_button).addClass("hidden"),a(h.restart_index_button).addClass("hidden"),h.index_progress_box.fadeOut("slow");else{var d="";0===c.responseJSON.data.is_network?(h.epTotalToIndex=c.responseJSON.data.ep_posts_total,h.epTotalIndexed=c.responseJSON.data.ep_posts_synced):(h.epSitesRemaining!==c.responseJSON.data.ep_sites_remaining&&(h.epSitesRemaining=c.responseJSON.data.ep_sites_remaining,h.epTotalToIndex+=c.responseJSON.data.ep_posts_total,h.epSitesCompleted++),d=h.epSitesCompleted+ep.sites,h.epTotalIndexed+=c.responseJSON.data.ep_current_synced);var e=parseFloat(b.epTotalIndexed)/parseFloat(b.epTotalToIndex);console.log(e),h.bar.progressbar({value:100*e}),h.status.text(h.epTotalIndexed+"/"+h.epTotalToIndex+" "+ep.items_indexed+d),1==c.responseJSON.data.ep_sync_complete?(h.bar.progressbar({value:100}),setTimeout(function(){h.index_progress_box.fadeOut("slow"),h.status.html(ep.complete_text),h.run_index_button.val(ep.index_complete_text).attr("disabled",!1),h.pause_index_button.addClass("hidden"),h.restart_index_button.addClass("hidden"),h.resetIndex()},500)):h.performIndex(!1)}}})},pauseIndex:function(){var b=this,c=this.pause_index_button.data("paused");if("enabled"===c)b.pause_index_button.val(ep.index_pause_text).data("paused","disabled"),b.pauseIndexing=!1,b.performIndex(!1);else{var d={action:"ep_pause_index",keep_active:keepActiveCheckbox.is(":checked"),nonce:ep.pause_nonce};a.ajax({url:ajaxurl,type:"POST",data:d,complete:function(a){b.pause_index_button.val(ep.index_resume_text).data("paused","enabled"),b.run_index_button.val(ep.index_paused_text).attr("disabled",!0),b.restart_index_button.removeClass("hidden"),b.pauseIndexing=!0}})}},restartIndex:function(){var c=this,d={action:"ep_restart_index",nonce:ep.restart_nonce};a.ajax({url:ajaxurl,type:"POST",data:d,complete:function(a){c.resetIndex(),c.restart_index_button.addClass("hidden"),c.pause_index_button.val(ep.index_pause_text).data("paused","disabled").addClass("hidden"),c.run_index_button.val(ep.index_complete_text).attr("disabled",!1),c.keep_active_checkbox.attr("disabled",!1),c.status.text(""),c.index_progress_box.fadeOut("slow"),b.pauseIndexing=!1}})},resetIndex:function(){this.epSitesRemaining=0,this.epTotalToIndex=0,this.epTotalIndexed=0},showProgressBar:function(){this.index_progress_box.show();var a=parseFloat(ep.synced_posts)/parseFloat(ep.total_posts);this.bar.progressbar({value:100*a}),this.status.text(ep.synced_posts+"/"+ep.total_posts+" "+ep.items_indexed)},changeSite:function(c){c.preventDefault();var d={action:"ep_get_site_stats",nonce:ep.stats_nonce,site:b.site_selector.val()};a.ajax({url:ajaxurl,type:"POST",data:d,complete:function(b){a("#ep_site_stats").html(b.responseJSON.data)}})},addEventListeners:function(){var a=this;a.run_index_button.on("click",function(c){c.preventDefault(),b.resetIndex(),a.status.text(ep.running_index_text),b.performIndex(!0)}),a.pause_index_button.on("click",function(a){a.preventDefault(),b.pauseIndex()}),a.restart_index_button.on("click",function(a){a.preventDefault(),b.restartIndex()}),a.site_selector.on("change",this.changeSite)},init:function(){1==ep.index_running&&1!=ep.paused&&b.performIndex(!0),1==ep.index_running&&1==ep.paused&&this.showProgressBar(),this.addEventListeners()}};b.init()}(jQuery);