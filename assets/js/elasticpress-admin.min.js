!function(a){var b={pauseIndexing:!1,indexing:!1,epSitesRemaining:0,epTotalToIndex:0,epTotalIndexed:0,epSitesCompleted:0,run_index_button:a("#ep_run_index"),pause_index_button:a("#ep_pause_index"),restart_index_button:a("#ep_restart_index"),keep_active_checkbox:a("#ep_keep_active"),site_selector:a("#ep_site_select"),status:a("#progressstats"),progress_percent:a("#progresspercent"),bar:a("#progressbar"),index_progress_box:a("#indexprogresss"),notice:a(".ep-notice"),performIndex:function(){this.pauseIndexing||(a(this.run_index_button).val(ep.running_index_text).attr("disabled",!0),a(this.keep_active_checkbox).attr("disabled",!0),a(this.restart_index_button).addClass("hidden"),a(this.pause_index_button).removeClass("hidden"),this.indexing||this.showProgressBar(),this.processIndex())},processIndex:function(b,c,d,e,f){var g=this,h={action:"ep_launch_index",nonce:ep.nonce};a.ajax({url:ajaxurl,type:"POST",data:h,complete:function(b){var c="";if("undefined"==typeof b.responseJSON||"undefined"==typeof b.responseJSON.data)g.status.text(ep.failed_text),a(g.run_index_button).val(ep.index_complete_text).attr("disabled",!1),a(g.pause_index_button).addClass("hidden"),a(g.restart_index_button).addClass("hidden"),g.index_progress_box.fadeOut("slow");else{0===b.responseJSON.data.is_network?(g.epTotalToIndex=b.responseJSON.data.ep_posts_total,g.epTotalIndexed=b.responseJSON.data.ep_posts_synced):(g.epSitesRemaining!==b.responseJSON.data.ep_sites_remaining&&(g.epSitesRemaining=b.responseJSON.data.ep_sites_remaining,g.epTotalToIndex+=b.responseJSON.data.ep_posts_total,g.epSitesCompleted++),c=g.epSitesCompleted+ep.sites,g.epTotalIndexed+=b.responseJSON.data.ep_current_synced);var d=Math.ceil(parseFloat(g.epTotalIndexed)/parseFloat(g.epTotalToIndex)*100);g.indexing=!0,g.bar.progressbar({value:d}),g.status.text(g.epTotalIndexed+"/"+g.epTotalToIndex+" "+ep.items_indexed+c),g.progress_percent.text(d+"%"),1==b.responseJSON.data.ep_sync_complete?(g.bar.progressbar({value:100}),g.progress_percent.text("100%"),g.notice.removeClass("hidden").find("p").text(ep.complete_text),a(".ep-error").remove(),a("#ep_activate").prop("disabled",!1),setTimeout(function(){g.index_progress_box.fadeOut("slow"),g.status.html(ep.complete_text),g.run_index_button.val(ep.index_complete_text).attr("disabled",!1),g.pause_index_button.addClass("hidden"),g.restart_index_button.addClass("hidden"),g.keep_active_checkbox.attr("disabled",!1),g.resetIndex(),g.indexing=!1},1e3)):g.performIndex()}}})},pauseIndex:function(){var b=this,c=this.pause_index_button.data("paused");if("enabled"===c)b.pause_index_button.val(ep.index_pause_text).data("paused","disabled"),b.pauseIndexing=!1,b.performIndex();else{var d={action:"ep_pause_index",keep_active:b.keep_active_checkbox.is(":checked"),nonce:ep.pause_nonce};a.ajax({url:ajaxurl,type:"POST",data:d,complete:function(a){b.pause_index_button.val(ep.index_resume_text).data("paused","enabled"),b.run_index_button.val(ep.index_paused_text).attr("disabled",!0),b.restart_index_button.removeClass("hidden"),b.pauseIndexing=!0}})}},restartIndex:function(){var b=this,c={action:"ep_restart_index",nonce:ep.restart_nonce};a.ajax({url:ajaxurl,type:"POST",data:c,complete:function(a){b.resetIndex(),b.restart_index_button.addClass("hidden"),b.pause_index_button.val(ep.index_pause_text).data("paused","disabled").addClass("hidden"),b.run_index_button.val(ep.index_complete_text).attr("disabled",!1),b.keep_active_checkbox.attr("disabled",!1),b.status.text(""),b.index_progress_box.fadeOut("slow"),b.pauseIndexing=!1,b.indexing=!1}})},resetIndex:function(){this.epSitesRemaining=0,this.epTotalToIndex=0,this.epTotalIndexed=0},showProgressBar:function(){this.index_progress_box.show();var a=Math.ceil(parseFloat(ep.synced_posts)/parseFloat(ep.total_posts)*100);this.bar.progressbar({value:a}),this.status.text(ep.synced_posts+"/"+ep.total_posts+" "+ep.items_indexed),this.progress_percent.text(a+"%")},changeSite:function(c){c.preventDefault();var d={action:"ep_get_site_stats",nonce:ep.stats_nonce,site:b.site_selector.val()};a.ajax({url:ajaxurl,type:"POST",data:d,complete:function(b){a("#ep_site_stats").html(b.responseJSON.data)}})},addEventListeners:function(){var a=this;a.run_index_button.on("click",function(c){c.preventDefault(),b.resetIndex(),a.status.text(ep.running_index_text),b.performIndex()}),a.pause_index_button.on("click",function(a){a.preventDefault(),b.pauseIndex()}),a.restart_index_button.on("click",function(a){a.preventDefault(),b.restartIndex()}),a.site_selector.on("change",this.changeSite)},init:function(){1==ep.index_running&&1!=ep.paused&&b.performIndex(),1==ep.index_running&&1==ep.paused&&this.showProgressBar(),this.addEventListeners()}};b.init()}(jQuery);